================================================================================
                    PROJET: SEGMENTATION MULTI-ORGANES PULMONAIRES
                              Pipeline Complet de A Ã  Z
================================================================================

ðŸ“‹ OBJECTIF GLOBAL DU PROJET:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
CrÃ©er un modÃ¨le d'intelligence artificielle (U-Net) capable de segmenter 
automatiquement 7 organes diffÃ©rents dans les scans CT pulmonaires:
  â€¢ GTV (Tumeur)
  â€¢ PTV (Volume cible de planification)
  â€¢ Poumon Droit
  â€¢ Poumon Gauche
  â€¢ CÅ“ur
  â€¢ Å’sophage
  â€¢ Moelle Ã©piniÃ¨re

ðŸ“Š DATASET:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- Source: NSCLC-Radiomics (Cancer du poumon non Ã  petites cellules)
- 158 patients traitÃ©s avec succÃ¨s
- 57,148 images CT (slices) au total
- RÃ©partition: 69.6% entraÃ®nement / 14.6% validation / 15.8% test


================================================================================
                              PHASE 2: CONVERSION DICOM â†’ NIFTI
================================================================================

ðŸŽ¯ OBJECTIF:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Convertir les images DICOM (format mÃ©dical standard) en format NIfTI pour 
faciliter le traitement avec Python.

ðŸ“‚ FICHIER:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
convert_dicom_to_nifti.py

ðŸ”§ Ã‰TAPES TECHNIQUES:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Lecture des fichiers DICOM dispersÃ©s dans plusieurs dossiers
2. Extraction des mÃ©tadonnÃ©es (position, orientation, Ã©paisseur de coupe)
3. Conversion des valeurs brutes en Hounsfield Units (HU):
   - HU = pixel_value Ã— slope + intercept
   - HU mesure la densitÃ© des tissus (-1000 = air, 0 = eau, +1000 = os)
4. Reconstruction du volume 3D complet
5. Sauvegarde en format NIfTI (.nii.gz) avec compression

ðŸ“Š RÃ‰SULTATS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… 159 patients traitÃ©s
âœ… Volumes 3D sauvegardÃ©s dans: DATA/processed/ct_nifti/
âœ… Taille moyenne: ~200-300 slices par patient
âœ… Format: (Z, H, W) oÃ¹ Z = nombre de coupes, H et W = dimensions spatiales

ðŸ–¼ï¸ VISUALISATION: phase2_dicom_to_nifti.png
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Cette image montre 3 Ã©tapes de conversion pour le patient LUNG1-002:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ COLONNE 1: DICOM Raw (Valeurs brutes)                                  â”‚
â”‚ - Valeurs natives du scanner (ex: 2000-4000)                           â”‚
â”‚ - Difficiles Ã  interprÃ©ter directement                                 â”‚
â”‚ - DÃ©pendent du scanner utilisÃ©                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ COLONNE 2: Hounsfield Units (HU)                                       â”‚
â”‚ - Valeurs standardisÃ©es (-1000 Ã  +3000 HU)                            â”‚
â”‚ - Noir (-1000) = Air (poumons)                                        â”‚
â”‚ - Gris moyen (0 Ã  +50) = Tissus mous                                  â”‚
â”‚ - Blanc (+1000) = Os                                                  â”‚
â”‚ - Ã‰chelle universelle, mÃªme densitÃ© = mÃªme HU sur tous les scanners  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ COLONNE 3: NIfTI Saved (SauvegardÃ©)                                   â”‚
â”‚ - Volume 3D complet reconstruit                                        â”‚
â”‚ - MÃ©tadonnÃ©es prÃ©servÃ©es (espacement, orientation)                    â”‚
â”‚ - PrÃªt pour le traitement Python                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ðŸ’¡ POURQUOI CETTE Ã‰TAPE EST IMPORTANTE:
- Standardise les valeurs entre diffÃ©rents scanners
- Facilite le traitement automatique
- RÃ©duit la taille des fichiers (compression .gz)


================================================================================
                    PHASE 2.5: EXTRACTION MULTI-ORGANES (RTSTRUCT)
================================================================================

ðŸŽ¯ OBJECTIF:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Extraire les contours des 7 organes dessinÃ©s manuellement par les mÃ©decins
(stockÃ©s dans les fichiers RTSTRUCT) et les convertir en masques 3D.

ðŸ“‚ FICHIER:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
extract_multi_organ_masks.py

ðŸ”§ Ã‰TAPES TECHNIQUES:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Lecture du fichier RTSTRUCT (RT Structure Set)
2. Identification des structures par leur nom:
   - "GTV-1", "GTV-2", etc. â†’ Fusion en un seul label GTV
   - "PTV" â†’ Planning Target Volume
   - "POUMON D" / "LUNG_R" â†’ Poumon droit
   - "POUMON G" / "LUNG_L" â†’ Poumon gauche
   - "COEUR" / "HEART" â†’ CÅ“ur
   - "OESOPHAGE" / "ESOPHAGUS" â†’ Å’sophage
   - "MOELLE" / "SPINALCORD" â†’ Moelle Ã©piniÃ¨re
3. Conversion des contours 2D en masques 3D
4. Attribution d'un label unique (1-7) Ã  chaque organe
5. Fusion de tous les masques en un seul volume multi-classes

ðŸ“Š SYSTÃˆME DE LABELS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Label 0: Background (Fond noir) - Tout ce qui n'est pas un organe
Label 1: GTV (Rouge) - Tumeur (Gross Tumor Volume)
Label 2: PTV (Orange) - Volume cible pour la radiothÃ©rapie
Label 3: Poumon Droit (Cyan) - Poumon droit complet
Label 4: Poumon Gauche (Bleu clair) - Poumon gauche complet
Label 5: CÅ“ur (Magenta) - CÅ“ur complet
Label 6: Å’sophage (Jaune) - Conduit digestif vertical
Label 7: Moelle Ã©piniÃ¨re (Vert) - Moelle dans la colonne vertÃ©brale

ðŸ“Š RÃ‰SULTATS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… 158 patients traitÃ©s (1 patient sans CT correspondant)
âœ… Masques multi-organes sauvegardÃ©s dans: DATA/processed/masks_multi_organ/
âœ… Chaque masque = volume 3D avec valeurs 0-7
âœ… En moyenne: 4-6 organes visibles par slice

ðŸ–¼ï¸ VISUALISATION: phase2_5_multi_organ.png
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Cette image montre l'extraction pour le patient LUNG1-002, slice 84:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LIGNE 1: CT Original (Niveaux de gris)                                â”‚
â”‚ - Image anatomique de base                                            â”‚
â”‚ - On voit les poumons (noir), les tissus mous (gris), les os (blanc) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LIGNE 2: Masque Multi-Organes (Couleurs)                              â”‚
â”‚ - 6 organes segmentÃ©s sur cette coupe:                                â”‚
â”‚   * Rouge (centre): Tumeur (GTV)                                      â”‚
â”‚   * Cyan (gauche): Poumon droit                                       â”‚
â”‚   * Bleu clair (droite): Poumon gauche                                â”‚
â”‚   * Magenta (bas centre): CÅ“ur                                        â”‚
â”‚   * Jaune (centre): Å’sophage                                          â”‚
â”‚   * Vert (arriÃ¨re centre): Moelle Ã©piniÃ¨re                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LIGNE 3: CT + Overlay (Fusion)                                        â”‚
â”‚ - Image CT avec masques superposÃ©s (transparence 70%)                 â”‚
â”‚ - Permet de vÃ©rifier l'alignement anatomique                          â”‚
â”‚ - Les couleurs montrent prÃ©cisÃ©ment oÃ¹ se trouvent les organes        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ðŸ’¡ POURQUOI CETTE Ã‰TAPE EST IMPORTANTE:
- CrÃ©e les "vÃ©ritÃ©s terrain" (ground truth) pour l'entraÃ®nement
- Un seul fichier par patient au lieu de 7 fichiers sÃ©parÃ©s
- Labels cohÃ©rents sur tous les patients


================================================================================
                         PHASE 3: NORMALISATION DES IMAGES
================================================================================

ðŸŽ¯ OBJECTIF:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PrÃ©parer les images CT pour le rÃ©seau de neurones en appliquant des 
transformations qui amÃ©liorent la qualitÃ© et standardisent les donnÃ©es.

ðŸ“‚ FICHIER:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
normalize_ct_and_masks.py

ðŸ”§ Ã‰TAPES TECHNIQUES:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Ã‰TAPE 1: WINDOWING (FenÃªtrage)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- Applique une "fenÃªtre pulmonaire": [-1000 HU, 400 HU]
- Concentre les valeurs sur les tissus pulmonaires d'intÃ©rÃªt
- Ã‰limine les valeurs extrÃªmes (air extÃ©rieur, os trÃ¨s denses)
- Formule: clip(HU, -1000, 400)

Ã‰TAPE 2: Z-SCORE NORMALIZATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- Calcule moyenne (Î¼) et Ã©cart-type (Ïƒ) de l'image
- Transforme en: z = (HU - Î¼) / Ïƒ
- RÃ©sultat: valeurs centrÃ©es autour de 0 avec Ã©cart-type 1
- Facilite l'entraÃ®nement du rÃ©seau (convergence plus rapide)

Ã‰TAPE 3: RESIZE (Redimensionnement)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- Redimensionne toutes les images Ã  256Ã—256 pixels
- Utilise l'interpolation bilinÃ©aire pour CT (valeurs continues)
- Utilise l'interpolation nearest pour masques (prÃ©serve les labels)
- Uniformise la taille pour le traitement par batch

ðŸ“Š RÃ‰SULTATS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… 158 patients normalisÃ©s
âœ… CTs sauvegardÃ©s dans: DATA/processed/normalized_ct/
âœ… Masques redimensionnÃ©s dans: DATA/processed/normalized_masks/
âœ… Format final: 256Ã—256 pixels, valeurs z-score normalisÃ©es

ðŸ–¼ï¸ VISUALISATION: phase3_normalization.png
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Cette image compare les Ã©tapes de normalisation pour LUNG1-002, slice 84:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LIGNE 1: Original (Hounsfield Units)                                  â”‚
â”‚ - Valeurs brutes: -1000 (air) Ã  +1000 (os)                           â”‚
â”‚ - Large plage dynamique                                               â”‚
â”‚ - Contraste naturel mais pas optimal pour IA                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LIGNE 2: AprÃ¨s Windowing [-1000, 400]                                 â”‚
â”‚ - Suppression des valeurs extrÃªmes                                    â”‚
â”‚ - Focus sur la plage pulmonaire                                       â”‚
â”‚ - Meilleur contraste pour poumons, tissus mous et tumeurs            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LIGNE 3: AprÃ¨s Z-score Normalization                                  â”‚
â”‚ - Valeurs standardisÃ©es (moyenneâ‰ˆ0, Ã©cart-typeâ‰ˆ1)                    â”‚
â”‚ - Distribution gaussienne centrÃ©e                                     â”‚
â”‚ - Format optimal pour les rÃ©seaux de neurones                        â”‚
â”‚ - Facilite l'apprentissage et la convergence                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ðŸ’¡ POURQUOI CETTE Ã‰TAPE EST IMPORTANTE:
- Ã‰limine les variations dues aux diffÃ©rents scanners
- AmÃ©liore le contraste pour les structures d'intÃ©rÃªt
- AccÃ©lÃ¨re l'entraÃ®nement du rÃ©seau (convergence plus stable)
- RÃ©duit le risque d'explosion/disparition des gradients


================================================================================
                        PHASE 4: DATASET PYTORCH (PRÃ‰PARATION)
================================================================================

ðŸŽ¯ OBJECTIF:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
CrÃ©er un systÃ¨me de chargement efficace des donnÃ©es pour l'entraÃ®nement du
rÃ©seau de neurones. Transformation des fichiers 3D en slices 2D individuelles.

ðŸ“‚ FICHIERS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- dataset_multi_organ.py (Classe PyTorch Dataset)
- prepare_train_val_test_splits.py (Division train/val/test)

ðŸ”§ Ã‰TAPES TECHNIQUES:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Ã‰TAPE 1: DIVISION DES PATIENTS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- Train: 110 patients (69.6%) â†’ Pour apprendre
- Validation: 23 patients (14.6%) â†’ Pour ajuster les hyperparamÃ¨tres
- Test: 25 patients (15.8%) â†’ Pour Ã©valuer les performances finales
- Division alÃ©atoire avec seed fixe (reproductibilitÃ©)
- SauvegardÃ© dans: splits/ (train.txt, val.txt, test.txt)

Ã‰TAPE 2: INDEXATION SLICE-PAR-SLICE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- Chaque volume 3D dÃ©coupÃ© en slices 2D individuelles
- Index crÃ©Ã©: (patient_id, chemin_ct, chemin_mask, slice_idx)
- Total: 57,148 slices indexÃ©es
  * Train: 39,867 slices (70%)
  * Val: 7,702 slices (13%)
  * Test: 9,579 slices (17%)

Ã‰TAPE 3: CHARGEMENT Ã€ LA DEMANDE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- Classe MultiOrganDataset hÃ©rite de torch.utils.data.Dataset
- MÃ©thode __getitem__(idx):
  1. Charge le volume 3D NIfTI complet
  2. Extrait la slice demandÃ©e
  3. Convertit en tenseur PyTorch
  4. Retourne (CT_slice, mask_slice)
- Optimisation mÃ©moire: charge uniquement les slices nÃ©cessaires

ðŸ“Š RÃ‰SULTATS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… Dataset indexÃ©: 57,148 images 2D (256Ã—256)
âœ… Format d'entrÃ©e: CT (1 canal, grayscale)
âœ… Format de sortie: Masque (1 canal, labels 0-7)
âœ… Compatible avec DataLoader PyTorch (batch processing)

ðŸ–¼ï¸ VISUALISATION: phase4_dataset_pytorch.png
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Cette image montre 4 exemples chargÃ©s depuis le Dataset PyTorch:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LIGNE 1: CT Slice (EntrÃ©e du rÃ©seau)                                  â”‚
â”‚ - Images normalisÃ©es prÃªtes pour U-Net                                â”‚
â”‚ - 1 canal (grayscale)                                                 â”‚
â”‚ - Dimensions: 256Ã—256 pixels                                          â”‚
â”‚ - Valeurs: z-score normalisÃ©es (moyenneâ‰ˆ0, stdâ‰ˆ1)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LIGNE 2: Multi-Organ Mask (VÃ©ritÃ© terrain)                            â”‚
â”‚ - Segmentation manuelle par les mÃ©decins                              â”‚
â”‚ - 1 canal avec valeurs 0-7 (labels des classes)                      â”‚
â”‚ - Couleurs pour visualisation uniquement                              â”‚
â”‚ - Chaque pixel = ID de l'organe correspondant                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LIGNE 3: CT + Overlay (Î±=0.7) (VÃ©rification)                         â”‚
â”‚ - Superposition pour vÃ©rifier l'alignement spatial                    â”‚
â”‚ - Les couleurs montrent que CT et masque correspondent exactement     â”‚
â”‚ - Transparence 70% pour voir Ã  la fois l'anatomie et les labels      â”‚
â”‚ - Validation visuelle: les masques suivent bien les organes          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ðŸ’¡ CE QUE MONTRE CETTE VISUALISATION:
- Le Dataset charge correctement les paires (CT, mask)
- L'alignement spatial est parfait (overlay prÃ©cis)
- Les slices sÃ©lectionnÃ©es contiennent 5+ organes (riches en information)
- DonnÃ©es prÃªtes pour l'entraÃ®nement du rÃ©seau


================================================================================
                     VISUALISATION: dataset_statistics.png
================================================================================

ðŸ–¼ï¸ GRAPHIQUE 1: Distribution des Patients (Camembert)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Train: 110 patients (69.6%) - En vert                                 â”‚
â”‚ - Ensemble principal pour apprendre les patterns                      â”‚
â”‚ - Le rÃ©seau voit ces patients pendant l'entraÃ®nement                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Validation: 23 patients (14.6%) - En orange                           â”‚
â”‚ - Permet d'ajuster les hyperparamÃ¨tres (learning rate, etc.)         â”‚
â”‚ - Surveille le surapprentissage (overfitting)                        â”‚
â”‚ - Le rÃ©seau ne s'entraÃ®ne pas dessus mais les "voit" rÃ©guliÃ¨rement   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Test: 25 patients (15.8%) - En rouge                                  â”‚
â”‚ - Ã‰valuation finale des performances                                  â”‚
â”‚ - Le rÃ©seau ne les voit JAMAIS pendant l'entraÃ®nement                â”‚
â”‚ - Simule des donnÃ©es "jamais vues" (nouveaux patients)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ðŸ–¼ï¸ GRAPHIQUE 2: Distribution des Slices (Barres)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- Train: 39,867 slices (70%) - Plus de donnÃ©es = meilleur apprentissage
- Val: 7,702 slices (13%) - Suffisant pour validation rÃ©guliÃ¨re
- Test: 9,579 slices (17%) - Ã‰valuation robuste sur donnÃ©es non vues

ðŸ’¡ POURQUOI CES PROPORTIONS:
- 70-15-15 est un standard en Machine Learning
- Train > Val > Test pour maximiser l'apprentissage
- Validation assez grande pour dÃ©tecter l'overfitting
- Test indÃ©pendant pour mesurer la gÃ©nÃ©ralisation rÃ©elle


================================================================================
                        PHASE 5: MODÃˆLE U-NET ET ENTRAÃŽNEMENT
================================================================================

ðŸŽ¯ OBJECTIF:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
EntraÃ®ner un rÃ©seau de neurones profond (U-Net) pour prÃ©dire automatiquement
les masques de segmentation multi-organes Ã  partir des images CT.

ðŸ“‚ FICHIERS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. unet_multi_organ.py - Architecture du rÃ©seau
2. train_multi_organ.py - Script d'entraÃ®nement
3. colab_training_multi_organ.ipynb - Notebook Google Colab

ðŸ—ï¸ ARCHITECTURE U-NET:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         STRUCTURE EN U                                  â”‚
â”‚                                                                         â”‚
â”‚   Input: 256Ã—256Ã—1                                                     â”‚
â”‚      â†“                                                                  â”‚
â”‚   [Encoder: Downsampling] â”€â”€â†’ [Skip Connections] â”€â”€â†’ [Decoder: Upsampling]â”‚
â”‚      â†“ Conv 64                      â†“                     â†‘ Up 128     â”‚
â”‚      â†“ MaxPool                      â†“                     â†‘ Conv 64    â”‚
â”‚      â†“ Conv 128                     â†“                     â†‘ Up 256     â”‚
â”‚      â†“ MaxPool                      â†“                     â†‘ Conv 128   â”‚
â”‚      â†“ Conv 256                     â†“                     â†‘ Up 512     â”‚
â”‚      â†“ MaxPool                      â†“                     â†‘ Conv 256   â”‚
â”‚      â†“ Conv 512                     â†“                     â†‘ Up 1024    â”‚
â”‚      â†“ MaxPool                      â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†‘             â”‚
â”‚      â†“ Conv 1024 (Bottleneck)                                          â”‚
â”‚      â†“                                                                  â”‚
â”‚   Output: 256Ã—256Ã—8 (logits pour 8 classes)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ðŸ“Š STATISTIQUES DU MODÃˆLE:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- ParamÃ¨tres totaux: 31,036,936 (31 millions)
- Taille mÃ©moire: 118.40 MB
- EntrÃ©e: 1 canal (CT grayscale)
- Sortie: 8 canaux (probabilitÃ©s pour chaque classe)
- Architecture: 4 niveaux de downsampling + 4 niveaux d'upsampling

ðŸ”§ COMPOSANTS CLÃ‰S:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. ENCODER (Contractant Path):
   - Extrait des features de plus en plus abstraites
   - RÃ©duit la rÃ©solution spatiale (256 â†’ 128 â†’ 64 â†’ 32 â†’ 16)
   - Augmente le nombre de canaux (64 â†’ 128 â†’ 256 â†’ 512 â†’ 1024)
   - Capture le contexte global (oÃ¹ sont les organes?)

2. BOTTLENECK:
   - Niveau le plus profond (16Ã—16Ã—1024)
   - ReprÃ©sentation la plus compacte de l'image
   - Comprend la structure anatomique globale

3. DECODER (Expansive Path):
   - Reconstruit la rÃ©solution spatiale (16 â†’ 32 â†’ 64 â†’ 128 â†’ 256)
   - Utilise les skip connections pour rÃ©cupÃ©rer les dÃ©tails
   - PrÃ©dit les masques pixel par pixel

4. SKIP CONNECTIONS:
   - Connectent les niveaux encoder â†” decoder correspondants
   - Transmettent les dÃ©tails fins perdus lors du downsampling
   - Permettent une localisation prÃ©cise des contours d'organes

ðŸ“‰ FONCTION DE PERTE (COMBINED LOSS):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

LOSS = 0.5 Ã— CrossEntropyLoss + 0.5 Ã— DiceLoss

1. CrossEntropyLoss:
   - Compare la classe prÃ©dite vs la vraie classe pour chaque pixel
   - PÃ©nalise les erreurs de classification
   - Avec class_weights pour gÃ©rer le dÃ©sÃ©quilibre (background dominant)

2. DiceLoss:
   - Mesure le chevauchement entre masque prÃ©dit et masque rÃ©el
   - Dice = 2Ã—|Aâˆ©B| / (|A|+|B|)
   - Favorise la cohÃ©rence spatiale des rÃ©gions
   - ParticuliÃ¨rement efficace pour les petits organes (Å“sophage, moelle)

3. Pourquoi combiner les deux:
   - CrossEntropy: Bon pour la classification pixel par pixel
   - Dice: Bon pour la forme et la continuitÃ© des organes
   - Combinaison = Meilleur de deux mondes

ðŸ“Š MÃ‰TRIQUES D'Ã‰VALUATION:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

DICE SCORE PAR ORGANE (0 Ã  1, 1 = parfait):
- Mesure la qualitÃ© de segmentation pour chaque organe
- Dice = 2 Ã— (pixels corrects) / (pixels prÃ©dits + pixels rÃ©els)
- CalculÃ© sÃ©parÃ©ment pour: GTV, PTV, Poumons D/G, CÅ“ur, Å’sophage, Moelle
- Objectif: Dice > 0.8 pour gros organes, > 0.7 pour petits organes

ðŸŽ“ STRATÃ‰GIE D'ENTRAÃŽNEMENT:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. OPTIMISEUR: Adam (lr=1e-4)
   - Adaptative learning rate pour chaque paramÃ¨tre
   - Converge plus rapidement que SGD

2. EARLY STOPPING (Patience=10):
   - Surveille la Validation Loss
   - ArrÃªte si pas d'amÃ©lioration pendant 10 epochs
   - Ã‰vite le surapprentissage (overfitting)

3. CHECKPOINT:
   - Sauvegarde automatique du meilleur modÃ¨le
   - CritÃ¨re: Validation Loss minimale
   - Fichier: best_unet_multi_organ.pth

4. BATCH SIZE:
   - DÃ©pend du GPU disponible
   - Colab GPU: 8-16 images par batch recommandÃ©
   - Plus grand batch = entraÃ®nement plus stable

ðŸš€ ENTRAÃŽNEMENT SUR GOOGLE COLAB:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Le notebook colab_training_multi_organ.ipynb contient 15 cellules:

CELLULE 1: Mount Google Drive
  - Connecte le Drive pour accÃ©der aux donnÃ©es
  - Les donnÃ©es doivent Ãªtre dans: /content/drive/MyDrive/RADIO_PROJET/

CELLULE 2: Check GPU
  - VÃ©rifie la prÃ©sence du GPU (Tesla T4, P100, ou V100)
  - Affiche la mÃ©moire GPU disponible

CELLULE 3: Install SimpleITK
  - Installe la bibliothÃ¨que pour lire les NIfTI

CELLULES 4-5: Upload des fichiers Python
  - Copie les scripts depuis Drive ou upload manuel

CELLULE 6: Load Splits
  - Charge les listes train.txt, val.txt, test.txt
  - 110 patients train, 23 val, 25 test

CELLULE 7: Create Datasets
  - Instancie MultiOrganDataset pour train et val
  - CrÃ©e les DataLoaders avec shuffle et num_workers

CELLULE 8: Calculate Class Weights (IMPORTANT!)
  - Compte les pixels de chaque classe sur tout le train set
  - DurÃ©e: 10-15 minutes
  - RÃ©sultat sauvegardÃ© dans class_weights.json (rÃ©utilisable)
  - Exemple de poids: Background faible, petits organes Ã©levÃ©s

CELLULE 9: Initialize Model
  - CrÃ©e UNetMultiOrgan(in_channels=1, out_channels=8)
  - DÃ©place sur GPU (.to(device))

CELLULE 10: Initialize Loss
  - CrÃ©e CombinedLoss avec class_weights
  - Combine CrossEntropy + Dice

CELLULE 11: Initialize Optimizer
  - Adam avec learning_rate=1e-4

CELLULE 12: TRAINING (Cellule principale)
  - Lance train_model() avec tous les paramÃ¨tres
  - DurÃ©e estimÃ©e: 3-4 heures pour 50 epochs
  - Affiche loss et Dice par epoch
  - Sauvegarde best_unet_multi_organ.pth automatiquement

CELLULE 13: Plot Training Curves
  - Graphiques Loss et Dice au fil du temps
  - Permet de voir convergence et overfitting

CELLULE 14: Load Best Model & Visualize
  - Charge le meilleur checkpoint
  - Affiche 4 prÃ©dictions sur validation set
  - Compare: CT | Masque rÃ©el | Masque prÃ©dit | Overlay

CELLULE 15: Final Summary
  - Affiche Dice Score final par organe
  - Statistiques globales

â±ï¸ TEMPS D'ENTRAÃŽNEMENT ESTIMÃ‰:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- Sur Google Colab GPU (Tesla T4): 3-4 heures pour 50 epochs
- Sur GPU local (RTX 3080): 2-3 heures
- CPU uniquement: 20-30 heures (NON RECOMMANDÃ‰)

ðŸ“ˆ RÃ‰SULTATS ATTENDUS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
AprÃ¨s entraÃ®nement, on s'attend Ã :
- Dice Score Poumons: 0.90-0.95 (gros organes, faciles)
- Dice Score CÅ“ur: 0.85-0.90 (moyen, contours nets)
- Dice Score Tumeur (GTV): 0.75-0.85 (varie selon taille)
- Dice Score Å’sophage: 0.70-0.80 (petit, difficile)
- Dice Score Moelle: 0.70-0.80 (trÃ¨s petit, linÃ©aire)
- Dice Score PTV: 0.80-0.85 (artificiel, plus facile que GTV)


================================================================================
                                RÃ‰SUMÃ‰ COMPLET
================================================================================

ðŸ“Š PIPELINE DE BOUT EN BOUT:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. PHASE 2 (DICOM â†’ NIfTI):
   âœ… 159 patients convertis
   âœ… Format standardisÃ© avec Hounsfield Units
   â†’ DurÃ©e: ~30 minutes

2. PHASE 2.5 (Extraction Multi-Organes):
   âœ… 158 patients avec 7 organes segmentÃ©s
   âœ… Labels unifiÃ©s (0-7) en un seul masque
   â†’ DurÃ©e: ~45 minutes

3. PHASE 3 (Normalisation):
   âœ… 158 patients normalisÃ©s (windowing + z-score + resize)
   âœ… Images 256Ã—256 prÃªtes pour Deep Learning
   â†’ DurÃ©e: ~20 minutes

4. PHASE 4 (Dataset PyTorch):
   âœ… 57,148 slices indexÃ©es (train/val/test)
   âœ… Chargement efficace avec DataLoader
   â†’ InstantanÃ© (indexation seulement)

5. PHASE 5 (U-Net Training):
   ðŸ”„ ModÃ¨le crÃ©Ã© (31M paramÃ¨tres)
   ðŸ”„ PrÃªt pour entraÃ®nement sur Google Colab
   â±ï¸ EntraÃ®nement estimÃ©: 3-4 heures

ðŸ“ FICHIERS PRINCIPAUX DU PROJET:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
convert_dicom_to_nifti.py          â†’ Phase 2
extract_multi_organ_masks.py       â†’ Phase 2.5
normalize_ct_and_masks.py          â†’ Phase 3
prepare_train_val_test_splits.py  â†’ Phase 4 (division)
dataset_multi_organ.py             â†’ Phase 4 (Dataset class)
unet_multi_organ.py                â†’ Phase 5 (modÃ¨le)
train_multi_organ.py               â†’ Phase 5 (entraÃ®nement)
colab_training_multi_organ.ipynb   â†’ Phase 5 (Colab)
visualize_all_phases.py            â†’ GÃ©nÃ©ration des 5 images

ðŸ“Š DONNÃ‰ES FINALES:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- Patients: 158 utilisables
- Slices totales: 57,148
- Classes: 8 (background + 7 organes)
- Format images: 256Ã—256 pixels
- Split: 70% train / 15% val / 15% test
- Taille totale: ~160 GB (avant compression)

ðŸŽ¯ OBJECTIF FINAL:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
CrÃ©er un modÃ¨le capable de segmenter automatiquement les 7 organes sur
n'importe quel scan CT pulmonaire, avec une prÃ©cision mÃ©dicale (Dice > 0.80).

Applications cliniques:
- Planification automatique de la radiothÃ©rapie
- Quantification volumÃ©trique des tumeurs
- Suivi de l'Ã©volution tumorale
- Aide au diagnostic

================================================================================
                                    FIN
================================================================================

ðŸ“§ Pour questions ou clarifications, rÃ©fÃ©rez-vous aux scripts Python.
ðŸŽ“ Ce projet combine Computer Vision, Deep Learning et Imagerie MÃ©dicale.
